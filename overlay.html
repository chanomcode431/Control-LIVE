<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>Game Overlay</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Black+Ops+One&family=Kanit:wght@800&display=swap');
        
        body { 
            background: transparent; margin: 0; overflow: hidden; 
            font-family: 'Kanit', sans-serif; display: flex; 
            justify-content: center; align-items: center; 
            height: 100vh; color: white; 
            /* ทำขอบตัวอักษรให้ชัดเพื่อใช้ใน OBS */
            text-shadow: 4px 4px 0px #000, -2px -2px 0 #000, 2px -2px 0 #000, -2px 2px 0 #000, 2px 2px 0 #000;
        }

        #display { 
            font-size: 150px; font-weight: 900; 
            font-family: 'Black Ops One', sans-serif; 
            transition: opacity 0.5s; opacity: 0; text-align: center; 
        }

        .show { opacity: 1 !important; }
        .panic { color: #ff5252; animation: pulse 0.5s infinite; }
        .msg-style { font-size: 80px; color: #00e676; }

        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
    </style>
</head>
<body>
    <div id="display">READY?</div>

    <script>
        // ใช้ Config เดียวกับหน้า index.html ของคุณ
        const firebaseConfig = {
            apiKey: "AIzaSyDgn9Vll-qcLhw7dcNtA9oGKy_BCRuefIs",
            authDomain: "control-tiktok.firebaseapp.com",
            databaseURL: "https://control-tiktok-default-rtdb.firebaseio.com",
            projectId: "control-tiktok"
        };
        
        if (!firebase.apps.length) { firebase.initializeApp(firebaseConfig); }

        const params = new URLSearchParams(window.location.search);
        const roomId = params.get('id');
        const displayEl = document.getElementById('display');
        let interval = null;

        if (roomId) {
            firebase.database().ref(roomId).on('value', (snap) => {
                const data = snap.val();
                if (!data) return;

                clearInterval(interval);

                if (data.mode === 'running') {
                    displayEl.classList.add('show');
                    interval = setInterval(() => {
                        const now = Date.now();
                        const diff = data.target - now;
                        const sinceStart = now - data.timestamp;

                        if (sinceStart < 2500) {
                            displayEl.innerText = (data.game === 'OnlyUp') ? "FLY MODE" : "READY?";
                        } else if (diff <= 0) {
                            displayEl.innerText = "0";
                            displayEl.className = "show panic";
                            clearInterval(interval);
                            setTimeout(() => displayEl.classList.remove('show'), 3000);
                        } else {
                            const s = Math.ceil(diff / 1000);
                            displayEl.innerText = s;
                            displayEl.className = s <= 3 ? "show panic" : "show";
                        }
                    }, 100);

                } else if (data.mode === 'text') {
                    displayEl.innerText = data.message;
                    displayEl.className = "show msg-style";
                    setTimeout(() => displayEl.classList.remove('show'), 5000);

                } else if (data.mode === 'stop') {
                    displayEl.classList.remove('show');
                }
            });
        } else {
            displayEl.innerText = "ID MISSING";
            displayEl.classList.add('show');
        }
    </script>
</body>
</html>
